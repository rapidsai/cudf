/*
 * Copyright (c) 2019-2023, NVIDIA CORPORATION.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#include <cudf_test/base_fixture.hpp>
#include <cudf_test/column_utilities.hpp>
#include <cudf_test/column_wrapper.hpp>
#include <cudf_test/cudf_gtest.hpp>
#include <cudf_test/io_metadata_utilities.hpp>
#include <cudf_test/iterator_utilities.hpp>
#include <cudf_test/table_utilities.hpp>
#include <cudf_test/type_lists.hpp>

#include <cudf/concatenate.hpp>
#include <cudf/copying.hpp>
#include <cudf/detail/iterator.cuh>
#include <cudf/fixed_point/fixed_point.hpp>
#include <cudf/io/data_sink.hpp>
#include <cudf/io/datasource.hpp>
#include <cudf/io/parquet.hpp>
#include <cudf/strings/strings_column_view.hpp>
#include <cudf/table/table.hpp>
#include <cudf/table/table_view.hpp>
#include <cudf/unary.hpp>
#include <cudf/utilities/span.hpp>

#include <src/io/parquet/compact_protocol_reader.hpp>
#include <src/io/parquet/parquet.hpp>
#include <src/io/parquet/parquet_gpu.hpp>

#include <rmm/cuda_stream_view.hpp>

#include <thrust/iterator/counting_iterator.h>

// Base test fixture for tests
struct ParquetWriterTest : public cudf::test::BaseFixture {};

TEST_F(ParquetWriterTest, NonNullable)
{
  //    auto in_filepath  = "/home/nghiat/Downloads/batch_0_part_0.parquet";
  auto in_filepath  = "/home/nghiat/TMP/group_df.parquet";
  auto out_filepath = "/home/nghiat/Downloads/out.parquet";

  std::vector<cudf::io::partition_info> partitions = {
    {0, 378},      {378, 347},    {725, 349},    {1074, 387},   {1461, 375},   {1836, 406},
    {2242, 377},   {2619, 361},   {2980, 364},   {3344, 382},   {3726, 376},   {4102, 368},
    {4470, 402},   {4872, 363},   {5235, 386},   {5621, 340},   {5961, 382},   {6343, 363},
    {6706, 360},   {7066, 386},   {7452, 379},   {7831, 386},   {8217, 362},   {8579, 386},
    {8965, 324},   {9289, 398},   {9687, 350},   {10037, 354},  {10391, 383},  {10774, 346},
    {11120, 402},  {11522, 355},  {11877, 375},  {12252, 372},  {12624, 424},  {13048, 378},
    {13426, 390},  {13816, 393},  {14209, 372},  {14581, 337},  {14918, 356},  {15274, 380},
    {15654, 331},  {15985, 374},  {16359, 386},  {16745, 402},  {17147, 390},  {17537, 313},
    {17850, 351},  {18201, 383},  {18584, 379},  {18963, 353},  {19316, 358},  {19674, 342},
    {20016, 350},  {20366, 387},  {20753, 357},  {21110, 377},  {21487, 363},  {21850, 374},
    {22224, 363},  {22587, 368},  {22955, 368},  {23323, 390},  {23713, 357},  {24070, 356},
    {24426, 355},  {24781, 371},  {25152, 350},  {25502, 401},  {25903, 348},  {26251, 381},
    {26632, 391},  {27023, 402},  {27425, 379},  {27804, 374},  {28178, 407},  {28585, 381},
    {28966, 350},  {29316, 370},  {29686, 375},  {30061, 385},  {30446, 372},  {30818, 366},
    {31184, 363},  {31547, 417},  {31964, 356},  {32320, 366},  {32686, 364},  {33050, 371},
    {33421, 342},  {33763, 360},  {34123, 394},  {34517, 342},  {34859, 397},  {35256, 414},
    {35670, 385},  {36055, 379},  {36434, 351},  {36785, 358},  {37143, 351},  {37494, 344},
    {37838, 387},  {38225, 358},  {38583, 374},  {38957, 355},  {39312, 318},  {39630, 375},
    {40005, 357},  {40362, 361},  {40723, 368},  {41091, 362},  {41453, 363},  {41816, 411},
    {42227, 344},  {42571, 363},  {42934, 413},  {43347, 346},  {43693, 392},  {44085, 379},
    {44464, 373},  {44837, 374},  {45211, 378},  {45589, 356},  {45945, 332},  {46277, 356},
    {46633, 376},  {47009, 381},  {47390, 340},  {47730, 374},  {48104, 411},  {48515, 376},
    {48891, 343},  {49234, 393},  {49627, 356},  {49983, 386},  {50369, 381},  {50750, 348},
    {51098, 378},  {51476, 377},  {51853, 385},  {52238, 361},  {52599, 338},  {52937, 399},
    {53336, 385},  {53721, 404},  {54125, 389},  {54514, 363},  {54877, 352},  {55229, 301},
    {55530, 102},  {55632, 16},   {55648, 56},   {55704, 404},  {56108, 369},  {56477, 362},
    {56839, 371},  {57210, 359},  {57569, 377},  {57946, 363},  {58309, 380},  {58689, 383},
    {59072, 370},  {59442, 356},  {59798, 407},  {60205, 363},  {60568, 372},  {60940, 346},
    {61286, 348},  {61634, 364},  {61998, 347},  {62345, 378},  {62723, 390},  {63113, 389},
    {63502, 368},  {63870, 385},  {64255, 372},  {64627, 411},  {65038, 392},  {65430, 389},
    {65819, 367},  {66186, 391},  {66577, 370},  {66947, 398},  {67345, 338},  {67683, 406},
    {68089, 417},  {68506, 362},  {68868, 379},  {69247, 380},  {69627, 392},  {70019, 402},
    {70421, 368},  {70789, 370},  {71159, 356},  {71515, 375},  {71890, 392},  {72282, 362},
    {72644, 352},  {72996, 391},  {73387, 382},  {73769, 378},  {74147, 373},  {74520, 388},
    {74908, 333},  {75241, 353},  {75594, 140},  {75734, 75},   {75809, 373},  {76182, 398},
    {76580, 397},  {76977, 365},  {77342, 359},  {77701, 394},  {78095, 347},  {78442, 433},
    {78875, 356},  {79231, 394},  {79625, 384},  {80009, 373},  {80382, 360},  {80742, 360},
    {81102, 383},  {81485, 325},  {81810, 328},  {82138, 340},  {82478, 357},  {82835, 383},
    {83218, 360},  {83578, 372},  {83950, 386},  {84336, 374},  {84710, 407},  {85117, 352},
    {85469, 380},  {85849, 416},  {86265, 349},  {86614, 373},  {86987, 376},  {87363, 95},
    {87458, 212},  {87670, 369},  {88039, 363},  {88402, 389},  {88791, 389},  {89180, 367},
    {89547, 381},  {89928, 375},  {90303, 381},  {90684, 366},  {91050, 399},  {91449, 367},
    {91816, 357},  {92173, 356},  {92529, 365},  {92894, 357},  {93251, 362},  {93613, 411},
    {94024, 377},  {94401, 362},  {94763, 399},  {95162, 241},  {95403, 340},  {95743, 339},
    {96082, 375},  {96457, 388},  {96845, 366},  {97211, 373},  {97584, 372},  {97956, 373},
    {98329, 353},  {98682, 359},  {99041, 381},  {99422, 369},  {99791, 367},  {100158, 383},
    {100541, 377}, {100918, 241}, {101159, 35},  {101194, 380}, {101574, 373}, {101947, 341},
    {102288, 354}, {102642, 390}, {103032, 406}, {103438, 358}, {103796, 390}, {104186, 368},
    {104554, 368}, {104922, 370}, {105292, 350}, {105642, 15},  {105657, 308}, {105965, 356},
    {106321, 372}, {106693, 354}, {107047, 375}, {107422, 362}, {107784, 380}, {108164, 362},
    {108526, 368}, {108894, 390}, {109284, 23},  {109307, 291}, {109598, 367}, {109965, 382},
    {110347, 375}, {110722, 388}, {111110, 393}, {111503, 357}, {111860, 349}, {112209, 134},
    {112343, 269}, {112612, 385}, {112997, 379}, {113376, 385}, {113761, 358}, {114119, 350},
    {114469, 393}, {114862, 67},  {114929, 139}, {115068, 358}, {115426, 370}, {115796, 364},
    {116160, 375}, {116535, 407}, {116942, 211}, {117153, 167}, {117320, 394}, {117714, 342},
    {118056, 365}, {118421, 373}, {118794, 312}, {119106, 125}, {119231, 348}, {119579, 351},
    {119930, 369}, {120299, 421}, {120720, 106}, {120826, 109}, {120935, 400}, {121335, 349},
    {121684, 381}, {122065, 286}, {122351, 185}, {122536, 388}, {122924, 385}, {123309, 383},
    {123692, 96},  {123788, 135}, {123923, 413}, {124336, 352}, {124688, 381}, {125069, 14},
    {125083, 310}, {125393, 356}, {125749, 344}, {126093, 58},  {126151, 268}, {126419, 347},
    {126766, 329}, {127095, 82},  {127177, 42},  {127219, 362}, {127581, 376}, {127957, 191},
    {128148, 318}, {128466, 375}, {128841, 219}, {129060, 235}, {129295, 344}, {129639, 257},
    {129896, 5},   {129901, 359}, {130260, 410}, {130670, 28},  {130698, 300}, {130998, 319},
    {131317, 100}, {131417, 152}, {131569, 381}, {131950, 195}, {132145, 273}, {132418, 338},
    {132756, 47},  {132803, 165}, {132968, 401}, {133369, 72},  {133441, 340}, {133781, 312},
    {134093, 215}, {134308, 408}, {134716, 2},   {134718, 175}, {134893, 349}, {135242, 28},
    {135270, 82},  {135352, 394}, {135746, 83},  {135829, 117}, {135946, 377}, {136323, 35},
    {136358, 15},  {136373, 389}, {136762, 109}, {136871, 362}, {137233, 99},  {137332, 206},
    {137538, 282}, {137820, 286}, {138106, 154}, {138260, 290}, {138550, 80},  {138630, 130},
    {138760, 277}, {139037, 123}, {139160, 245}, {139405, 89},  {139494, 327}, {139821, 84},
    {139905, 291}, {140196, 319}, {140515, 31},  {140546, 73},  {140619, 293}, {140912, 305},
    {141217, 45},  {141262, 336}, {141598, 164}, {141762, 149}, {141911, 175}, {142086, 157},
    {142243, 294}, {142537, 65},  {142602, 230}, {142832, 107}, {142939, 198}, {143137, 119},
    {143256, 268}, {143524, 182}, {143706, 61},  {143767, 235}, {144002, 21},  {144023, 22},
    {144045, 263}, {144308, 243}, {144551, 1},   {144552, 239}, {144791, 25},  {144816, 217},
    {145033, 56},  {145089, 165}, {145254, 208}, {145462, 245}, {145707, 20},  {145727, 234},
    {145961, 213}, {146174, 130}, {146304, 57},  {146361, 1},   {146362, 174}, {146536, 206},
    {146742, 210}, {146952, 257}, {147209, 21},  {147230, 188}, {147418, 172}, {147590, 25},
    {147615, 70},  {147685, 117}, {147802, 211}, {148013, 201}, {148214, 175}, {148389, 38},
    {148427, 165}, {148592, 56},  {148648, 140}, {148788, 160}, {148948, 199}, {149147, 152},
    {149299, 109}, {149408, 72},  {149480, 52},  {149532, 103}, {149635, 165}, {149800, 154},
    {149954, 55},  {150009, 69},  {150078, 137}, {150215, 24},  {150239, 152}, {150391, 172},
    {150563, 48},  {150611, 101}, {150712, 147}, {150859, 155}, {151014, 137}, {151151, 47},
    {151198, 83},  {151281, 167}, {151448, 49},  {151497, 90},  {151587, 153}, {151740, 132},
    {151872, 138}, {152010, 147}, {152157, 77},  {152234, 64},  {152298, 93},  {152391, 40},
    {152431, 122}, {152553, 2},   {152555, 127}, {152682, 130}, {152812, 148}, {152960, 69},
    {153029, 49},  {153078, 125}, {153203, 82},  {153285, 34},  {153319, 113}, {153432, 86},
    {153518, 102}, {153620, 104}, {153724, 102}, {153826, 24},  {153850, 75},  {153925, 121},
    {154046, 90},  {154136, 109}, {154245, 89},  {154334, 118}, {154452, 99},  {154551, 41},
    {154592, 64},  {154656, 78},  {154734, 96},  {154830, 96},  {154926, 73},  {154999, 27},
    {155026, 4},   {155030, 114}, {155144, 76},  {155220, 110}, {155330, 105}, {155435, 84},
    {155519, 98},  {155617, 12},  {155629, 66},  {155695, 75},  {155770, 23},  {155793, 93},
    {155886, 80},  {155966, 75},  {156041, 44},  {156085, 18},  {156103, 81},  {156184, 78},
    {156262, 16},  {156278, 51},  {156329, 82},  {156411, 89},  {156500, 81},  {156581, 90},
    {156671, 63},  {156734, 22},  {156756, 81},  {156837, 81},  {156918, 20},  {156938, 62},
    {157000, 60},  {157060, 89},  {157149, 1},   {157150, 78},  {157228, 73},  {157301, 63},
    {157364, 81},  {157445, 55},  {157500, 21},  {157521, 16},  {157537, 74},  {157611, 85},
    {157696, 77},  {157773, 65},  {157838, 70},  {157908, 60},  {157968, 57},  {158025, 68},
    {158093, 72},  {158165, 75},  {158240, 86},  {158326, 53},  {158379, 72},  {158451, 51},
    {158502, 69},  {158571, 84},  {158655, 62},  {158717, 20},  {158737, 35},  {158772, 71},
    {158843, 56},  {158899, 84},  {158983, 17},  {159000, 39},  {159039, 70},  {159109, 10},
    {159119, 77},  {159196, 50},  {159246, 4},   {159250, 54},  {159304, 79},  {159383, 67},
    {159450, 55},  {159505, 80},  {159585, 50},  {159635, 64},  {159699, 28},  {159727, 20},
    {159747, 52},  {159799, 21},  {159820, 31},  {159851, 60},  {159911, 65},  {159976, 60},
    {160036, 54},  {160090, 37},  {160127, 43},  {160170, 59},  {160229, 51},  {160280, 45},
    {160325, 46},  {160371, 52},  {160423, 53},  {160476, 55},  {160531, 56},  {160587, 43},
    {160630, 47},  {160677, 66},  {160743, 15},  {160758, 36},  {160794, 50},  {160844, 39},
    {160883, 37},  {160920, 5},   {160925, 63},  {160988, 44},  {161032, 69},  {161101, 43},
    {161144, 28},  {161172, 38},  {161210, 30},  {161240, 60},  {161300, 48},  {161348, 66},
    {161414, 63},  {161477, 36},  {161513, 27},  {161540, 43},  {161583, 53},  {161636, 37},
    {161673, 66},  {161739, 70},  {161809, 30},  {161839, 29},  {161868, 35},  {161903, 49},
    {161952, 14},  {161966, 48},  {162014, 35},  {162049, 33},  {162082, 64},  {162146, 37},
    {162183, 22},  {162205, 26},  {162231, 41},  {162272, 58},  {162330, 37},  {162367, 3},
    {162370, 39},  {162409, 31},  {162440, 42},  {162482, 47},  {162529, 2},   {162531, 31},
    {162562, 36},  {162598, 36},  {162634, 41},  {162675, 49},  {162724, 31},  {162755, 36},
    {162791, 12},  {162803, 41},  {162844, 48},  {162892, 44},  {162936, 29},  {162965, 42},
    {163007, 1},   {163008, 25},  {163033, 40},  {163073, 39},  {163112, 41},  {163153, 37},
    {163190, 46},  {163236, 56},  {163292, 44},  {163336, 41},  {163377, 37},  {163414, 51},
    {163465, 49},  {163514, 27},  {163541, 37},  {163578, 33},  {163611, 62},  {163673, 45},
    {163718, 52},  {163770, 29},  {163799, 36},  {163835, 5},   {163840, 38},  {163878, 4},
    {163882, 41},  {163923, 20},  {163943, 45},  {163988, 52},  {164040, 28},  {164068, 44},
    {164112, 43},  {164155, 28},  {164183, 58},  {164241, 36},  {164277, 30},  {164307, 35},
    {164342, 3},   {164345, 22},  {164367, 12},  {164379, 30},  {164409, 43},  {164452, 29},
    {164481, 22},  {164503, 20},  {164523, 31},  {164554, 45},  {164599, 30},  {164629, 4},
    {164633, 24},  {164657, 39},  {164696, 25},  {164721, 24},  {164745, 28},  {164773, 14},
    {164787, 10},  {164797, 16},  {164813, 35},  {164848, 20},  {164868, 49},  {164917, 36},
    {164953, 27},  {164980, 17},  {164997, 17},  {165014, 39},  {165053, 37},  {165090, 31},
    {165121, 26},  {165147, 39},  {165186, 28},  {165214, 3},   {165217, 24},  {165241, 40},
    {165281, 23},  {165304, 26},  {165330, 15},  {165345, 26},  {165371, 31},  {165402, 54},
    {165456, 8},   {165464, 12},  {165476, 25},  {165501, 62},  {165563, 30},  {165593, 18},
    {165611, 15},  {165626, 26},  {165652, 34},  {165686, 36},  {165722, 21},  {165743, 34},
    {165777, 24},  {165801, 22},  {165823, 25},  {165848, 28},  {165876, 7},   {165883, 4},
    {165887, 34},  {165921, 19},  {165940, 30},  {165970, 27},  {165997, 38},  {166035, 19},
    {166054, 2},   {166056, 30},  {166086, 18},  {166104, 43},  {166147, 16},  {166163, 17},
    {166180, 37},  {166217, 24},  {166241, 3},   {166244, 21},  {166265, 14},  {166279, 17},
    {166296, 27},  {166323, 24},  {166347, 32},  {166379, 12},  {166391, 21},  {166412, 25},
    {166437, 26},  {166463, 47},  {166510, 39},  {166549, 30},  {166579, 23},  {166602, 23},
    {166625, 22},  {166647, 8},   {166655, 14},  {166669, 34},  {166703, 12},  {166715, 18},
    {166733, 32},  {166765, 16},  {166781, 16},  {166797, 23},  {166820, 13},  {166833, 30},
    {166863, 37},  {166900, 50},  {166950, 30},  {166980, 43},  {167023, 19},  {167042, 11},
    {167053, 19},  {167072, 24},  {167096, 30},  {167126, 18},  {167144, 18},  {167162, 31},
    {167193, 27},  {167220, 31},  {167251, 24},  {167275, 14},  {167289, 12},  {167301, 7},
    {167308, 28},  {167336, 14},  {167350, 16},  {167366, 18},  {167384, 52},  {167436, 12},
    {167448, 20},  {167468, 14},  {167482, 20},  {167502, 24},  {167526, 10},  {167536, 16},
    {167552, 43},  {167595, 7},   {167602, 19},  {167621, 46},  {167667, 9},   {167676, 14},
    {167690, 15},  {167705, 25},  {167730, 32},  {167762, 26},  {167788, 24},  {167812, 28},
    {167840, 25},  {167865, 13},  {167878, 28},  {167906, 47},  {167953, 23},  {167976, 29},
    {168005, 19},  {168024, 17},  {168041, 6},   {168047, 28},  {168075, 23},  {168098, 10},
    {168108, 50},  {168158, 17},  {168175, 16},  {168191, 20},  {168211, 22},  {168233, 17},
    {168250, 27},  {168277, 8},   {168285, 13},  {168298, 16},  {168314, 25},  {168339, 33},
    {168372, 21},  {168393, 17},  {168410, 19},  {168429, 17},  {168446, 49},  {168495, 15},
    {168510, 16},  {168526, 8},   {168534, 32},  {168566, 36},  {168602, 22},  {168624, 8},
    {168632, 28},  {168660, 21},  {168681, 14},  {168695, 37},  {168732, 32},  {168764, 11},
    {168775, 20},  {168795, 11},  {168806, 22},  {168828, 19},  {168847, 28},  {168875, 22},
    {168897, 10},  {168907, 4},   {168911, 29},  {168940, 12},  {168952, 39},  {168991, 13},
    {169004, 57},  {169061, 8},   {169069, 11},  {169080, 44},  {169124, 10},  {169134, 38},
    {169172, 17},  {169189, 35},  {169224, 43},  {169267, 18},  {169285, 11},  {169296, 18},
    {169314, 17},  {169331, 10},  {169341, 70},  {169411, 40},  {169451, 28},  {169479, 16},
    {169495, 21},  {169516, 13},  {169529, 11},  {169540, 42},  {169582, 8},   {169590, 43},
    {169633, 17},  {169650, 32},  {169682, 36},  {169718, 40},  {169758, 14},  {169772, 45},
    {169817, 37},  {169854, 14},  {169868, 34},  {169902, 21},  {169923, 27},  {169950, 26},
    {169976, 26},  {170002, 20},  {170022, 27},  {170049, 31},  {170080, 20},  {170100, 25},
    {170125, 11},  {170136, 30},  {170166, 16},  {170182, 42},  {170224, 17},  {170241, 17},
    {170258, 26},  {170284, 45},  {170329, 12},  {170341, 41},  {170382, 36},  {170418, 17},
    {170435, 26},  {170461, 17},  {170478, 20},  {170498, 10},  {170508, 52},  {170560, 20},
    {170580, 26},  {170606, 57},  {170663, 53},  {170716, 11},  {170727, 47},  {170774, 12},
    {170786, 41},  {170827, 35},  {170862, 28},  {170890, 24},  {170914, 28},  {170942, 14},
    {170956, 19},  {170975, 69},  {171044, 11},  {171055, 15},  {171070, 13},  {171083, 18},
    {171101, 41},  {171142, 20},  {171162, 15},  {171177, 23},  {171200, 30},  {171230, 22},
    {171252, 10},  {171262, 22},  {171284, 6},   {171290, 13},  {171303, 16},  {171319, 24},
    {171343, 10},  {171353, 23},  {171376, 9},   {171385, 24},  {171409, 25},  {171434, 21},
    {171455, 24},  {171479, 9},   {171488, 17},  {171505, 27},  {171532, 18},  {171550, 19},
    {171569, 14},  {171583, 3},   {171586, 44},  {171630, 34},  {171664, 18},  {171682, 21},
    {171703, 18},  {171721, 16},  {171737, 21},  {171758, 20},  {171778, 18},  {171796, 7},
    {171803, 39},  {171842, 28},  {171870, 9},   {171879, 21},  {171900, 27},  {171927, 10},
    {171937, 22},  {171959, 34},  {171993, 21},  {172014, 14},  {172028, 24},  {172052, 8},
    {172060, 10},  {172070, 24},  {172094, 7},   {172101, 20},  {172121, 47},  {172168, 17},
    {172185, 16},  {172201, 32},  {172233, 21},  {172254, 14},  {172268, 31},  {172299, 31},
    {172330, 28},  {172358, 20},  {172378, 24},  {172402, 7},   {172409, 15},  {172424, 11},
    {172435, 7},   {172442, 40},  {172482, 8},   {172490, 9},   {172499, 26},  {172525, 23},
    {172548, 41},  {172589, 22},  {172611, 38},  {172649, 30},  {172679, 9},   {172688, 29},
    {172717, 15},  {172732, 11},  {172743, 40},  {172783, 32},  {172815, 6},   {172821, 19},
    {172840, 28},  {172868, 20},  {172888, 6},   {172894, 11},  {172905, 34},  {172939, 21},
    {172960, 9},   {172969, 3},   {172972, 12},  {172984, 36},  {173020, 7},   {173027, 10},
    {173037, 23},  {173060, 26},  {173086, 32},  {173118, 20},  {173138, 27},  {173165, 14},
    {173179, 23},  {173202, 28},  {173230, 42},  {173272, 17},  {173289, 14},  {173303, 16},
    {173319, 33},  {173352, 29},  {173381, 38},  {173419, 26},  {173445, 6},   {173451, 10},
    {173461, 24},  {173485, 32},  {173517, 14},  {173531, 22},  {173553, 25},  {173578, 30},
    {173608, 57},  {173665, 25},  {173690, 33},  {173723, 28},  {173751, 70},  {173821, 27},
    {173848, 15},  {173863, 9},   {173872, 35},  {173907, 37},  {173944, 38},  {173982, 5},
    {173987, 25},  {174012, 22},  {174034, 21},  {174055, 13},  {174068, 6},   {174074, 5},
    {174079, 18},  {174097, 31},  {174128, 27},  {174155, 9},   {174164, 65},  {174229, 18},
    {174247, 7},   {174254, 13},  {174267, 22},  {174289, 4},   {174293, 16},  {174309, 15},
    {174324, 11},  {174335, 25},  {174360, 39},  {174399, 26},  {174425, 31},  {174456, 17},
    {174473, 19},  {174492, 3},   {174495, 10},  {174505, 35},  {174540, 5},   {174545, 22},
    {174567, 29},  {174596, 28},  {174624, 23},  {174647, 9},   {174656, 5},   {174661, 13},
    {174674, 4},   {174678, 27},  {174705, 37},  {174742, 24},  {174766, 14},  {174780, 22},
    {174802, 11},  {174813, 19},  {174832, 39},  {174871, 28},  {174899, 29},  {174928, 19},
    {174947, 9},   {174956, 12},  {174968, 22},  {174990, 15},  {175005, 36},  {175041, 14},
    {175055, 39},  {175094, 25},  {175119, 27},  {175146, 22},  {175168, 27},  {175195, 5},
    {175200, 32},  {175232, 34},  {175266, 15},  {175281, 24},  {175305, 24},  {175329, 17},
    {175346, 13},  {175359, 6},   {175365, 42},  {175407, 5},   {175412, 20},  {175432, 11},
    {175443, 31},  {175474, 38},  {175512, 28},  {175540, 51},  {175591, 63},  {175654, 16},
    {175670, 54},  {175724, 31},  {175755, 41},  {175796, 15},  {175811, 32},  {175843, 8},
    {175851, 6},   {175857, 8},   {175865, 27},  {175892, 48},  {175940, 12},  {175952, 54},
    {176006, 10},  {176016, 32},  {176048, 29},  {176077, 5},   {176082, 16},  {176098, 34},
    {176132, 8},   {176140, 8},   {176148, 36},  {176184, 36},  {176220, 16},  {176236, 24},
    {176260, 43},  {176303, 20},  {176323, 14},  {176337, 17},  {176354, 50},  {176404, 54},
    {176458, 76},  {176534, 14},  {176548, 35},  {176583, 29},  {176612, 37},  {176649, 8},
    {176657, 5},   {176662, 38},  {176700, 24},  {176724, 32},  {176756, 13},  {176769, 30},
    {176799, 24},  {176823, 18},  {176841, 28},  {176869, 22},  {176891, 13},  {176904, 29},
    {176933, 47},  {176980, 27},  {177007, 20},  {177027, 28},  {177055, 22},  {177077, 7},
    {177084, 33},  {177117, 44},  {177161, 21},  {177182, 14},  {177196, 25},  {177221, 61},
    {177282, 37},  {177319, 5},   {177324, 29},  {177353, 11},  {177364, 15},  {177379, 7},
    {177386, 12},  {177398, 49},  {177447, 14},  {177461, 16},  {177477, 14},  {177491, 11},
    {177502, 28},  {177530, 12},  {177542, 25},  {177567, 11},  {177578, 22},  {177600, 5},
    {177605, 18},  {177623, 48},  {177671, 8},   {177679, 7},   {177686, 36},  {177722, 16},
    {177738, 31},  {177769, 10},  {177779, 29},  {177808, 7},   {177815, 42},  {177857, 52},
    {177909, 32},  {177941, 19},  {177960, 22},  {177982, 42},  {178024, 22},  {178046, 30},
    {178076, 27},  {178103, 10},  {178113, 18},  {178131, 41},  {178172, 24},  {178196, 27},
    {178223, 21},  {178244, 19},  {178263, 30},  {178293, 13},  {178306, 6},   {178312, 13},
    {178325, 37},  {178362, 46},  {178408, 24},  {178432, 29},  {178461, 6},   {178467, 55},
    {178522, 71},  {178593, 40},  {178633, 17},  {178650, 48},  {178698, 19},  {178717, 30},
    {178747, 12},  {178759, 40},  {178799, 8},   {178807, 11},  {178818, 22},  {178840, 21},
    {178861, 40},  {178901, 9},   {178910, 24},  {178934, 31},  {178965, 56},  {179021, 34},
    {179055, 49},  {179104, 15},  {179119, 39},  {179158, 27},  {179185, 19},  {179204, 13},
    {179217, 9},   {179226, 19},  {179245, 13},  {179258, 29},  {179287, 70},  {179357, 23},
    {179380, 62},  {179442, 31},  {179473, 39},  {179512, 14},  {179526, 57},  {179583, 25},
    {179608, 14},  {179622, 23},  {179645, 38},  {179683, 20},  {179703, 14},  {179717, 29},
    {179746, 41},  {179787, 21},  {179808, 22},  {179830, 3},   {179833, 26},  {179859, 26},
    {179885, 16},  {179901, 26},  {179927, 7},   {179934, 23},  {179957, 45},  {180002, 36},
    {180038, 64},  {180102, 30},  {180132, 61},  {180193, 32},  {180225, 19},  {180244, 49},
    {180293, 30},  {180323, 32},  {180355, 24},  {180379, 26},  {180405, 35},  {180440, 65},
    {180505, 28},  {180533, 42},  {180575, 22},  {180597, 36},  {180633, 8},   {180641, 13},
    {180654, 56},  {180710, 24},  {180734, 37},  {180771, 33},  {180804, 31},  {180835, 19},
    {180854, 17},  {180871, 16},  {180887, 11},  {180898, 35},  {180933, 15},  {180948, 23},
    {180971, 21},  {180992, 25},  {181017, 45},  {181062, 42},  {181104, 20},  {181124, 34},
    {181158, 29},  {181187, 23},  {181210, 19},  {181229, 23},  {181252, 28},  {181280, 26},
    {181306, 16},  {181322, 15},  {181337, 25},  {181362, 73},  {181435, 61},  {181496, 28},
    {181524, 23},  {181547, 30},  {181577, 35},  {181612, 43},  {181655, 12},  {181667, 21},
    {181688, 61},  {181749, 29},  {181778, 35},  {181813, 30},  {181843, 26},  {181869, 57},
    {181926, 29},  {181955, 22},  {181977, 23},  {182000, 57},  {182057, 31},  {182088, 25},
    {182113, 34},  {182147, 14},  {182161, 49},  {182210, 28},  {182238, 30},  {182268, 21},
    {182289, 88},  {182377, 75},  {182452, 18},  {182470, 91},  {182561, 38},  {182599, 38},
    {182637, 108}, {182745, 74},  {182819, 81},  {182900, 74},  {182974, 39},  {183013, 41},
    {183054, 34},  {183088, 26},  {183114, 102}, {183216, 48},  {183264, 50},  {183314, 85},
    {183399, 49},  {183448, 75},  {183523, 52},  {183575, 71},  {183646, 62},  {183708, 71},
    {183779, 77},  {183856, 55},  {183911, 185}, {184096, 255}, {184351, 786}};

  {
    cudf::io::parquet_reader_options read_opts =
      cudf::io::parquet_reader_options::builder(cudf::io::source_info{in_filepath});
    auto df = cudf::io::read_parquet(read_opts);

    cudf::io::parquet_writer_options write_opts =
      cudf::io::parquet_writer_options::builder(cudf::io::sink_info{out_filepath}, *df.tbl)
        .partitions(partitions);
    cudf::io::write_parquet(write_opts);
  }

  {
    cudf::io::parquet_reader_options read_opts =
      cudf::io::parquet_reader_options::builder(cudf::io::source_info{out_filepath});
    auto df = cudf::io::read_parquet(read_opts);
  }
}
