name: Compute Sanitizer

on:
  workflow_dispatch:

jobs:
  discover-sanitizer-tests:
    runs-on: linux-amd64-cpu4
    container:
      image: rapidsai/ci-conda:25.12-latest
    outputs:
      tests: ${{ steps.find-tests.outputs.tests }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      - name: Discover test executables
        id: find-tests
        shell: bash
        run: |
          ./ci/discover_libcudf_tests.sh
  run-sanitizer-tests-memcheck:
    name: compute-sanitizer memcheck tests
    needs: discover-sanitizer-tests
    uses: ./.github/workflows/compute-sanitizer-run.yaml
    with:
      tool_name: "memcheck"
      test_names: ${{ needs.discover-sanitizer-tests.outputs.tests }}
  run-sanitizer-tests-racecheck:
    name: compute-sanitizer racecheck tests
    needs: discover-sanitizer-tests
    uses: ./.github/workflows/compute-sanitizer-run.yaml
    with:
      tool_name: "racecheck"
      test_names: ${{ needs.discover-sanitizer-tests.outputs.tests }}
  run-sanitizer-tests-initcheck:
    name: compute-sanitizer initcheck tests
    needs: discover-sanitizer-tests
    uses: ./.github/workflows/compute-sanitizer-run.yaml
    with:
      tool_name: "initcheck"
      test_names: ${{ needs.discover-sanitizer-tests.outputs.tests }}
  run-sanitizer-tests-synccheck:
    name: compute-sanitizer synccheck tests
    needs: discover-sanitizer-tests
    uses: ./.github/workflows/compute-sanitizer-run.yaml
    with:
      tool_name: "synccheck"
      test_names: ${{ needs.discover-sanitizer-tests.outputs.tests }}
